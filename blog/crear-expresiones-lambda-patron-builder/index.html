<!DOCTYPE html>
<html lang="es-ES">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Crear expresiones lambda dinámicamente mediante el patrón Builder | Rafael Neto</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/images/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/images/icons/icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#d66056">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-S8PRT356B6"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-S8PRT356B6', { 'anonymize_ip': true });</script>
    <link rel="alternate" type="application/rss+xml" href="https://rafaelneto.dev/rss.xml" title="Rafael Neto RSS Feed">
    <meta name="description" content="Las expresiones lambda son una herramienta poderosa en el mundo de la programación que nos permite escribir funciones anónimas que pueden ser asignadas a una variable o pasadas como argumentos a una función.">
    <meta property="article:published_time" content="2023-05-10T00:00:00.000Z">
    <meta property="og:site_name" content="Rafael Neto">
    <meta property="og:title" content="Crear expresiones lambda dinámicamente mediante el patrón Builder">
    <meta property="og:description" content="Las expresiones lambda son una herramienta poderosa en el mundo de la programación que nos permite escribir funciones anónimas que pueden ser asignadas a una variable o pasadas como argumentos a una función.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/blog/crear-expresiones-lambda-patron-builder/">
    <meta name="twitter:title" content="Crear expresiones lambda dinámicamente mediante el patrón Builder">
    <meta name="twitter:description" content="Las expresiones lambda son una herramienta poderosa en el mundo de la programación que nos permite escribir funciones anónimas que pueden ser asignadas a una variable o pasadas como argumentos a una función.">
    <meta name="twitter:url" content="/blog/crear-expresiones-lambda-patron-builder/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="CSharp, PatronDeDiseño">
    <meta property="article:tag" content="CSharp">
    <meta name="theme-color" content="#d66056">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/images/icons/icon-144x144">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.bb0c19ce.css" as="style"><link rel="preload" href="/assets/js/app.ee019d85.js" as="script"><link rel="preload" href="/assets/js/4.35e6b205.js" as="script"><link rel="preload" href="/assets/js/1.801c1b6e.js" as="script"><link rel="preload" href="/assets/js/61.6ae343dc.js" as="script"><link rel="prefetch" href="/assets/js/11.7f50e1d9.js"><link rel="prefetch" href="/assets/js/12.e5fcd202.js"><link rel="prefetch" href="/assets/js/13.89648ad6.js"><link rel="prefetch" href="/assets/js/14.c6a608cd.js"><link rel="prefetch" href="/assets/js/15.00d4c987.js"><link rel="prefetch" href="/assets/js/16.f0891c93.js"><link rel="prefetch" href="/assets/js/17.93778a3e.js"><link rel="prefetch" href="/assets/js/18.1468113e.js"><link rel="prefetch" href="/assets/js/19.40f9e796.js"><link rel="prefetch" href="/assets/js/2.ff0695d0.js"><link rel="prefetch" href="/assets/js/20.7c41a12f.js"><link rel="prefetch" href="/assets/js/21.fc80806c.js"><link rel="prefetch" href="/assets/js/22.40f1a2c2.js"><link rel="prefetch" href="/assets/js/23.099cf4dd.js"><link rel="prefetch" href="/assets/js/24.27062614.js"><link rel="prefetch" href="/assets/js/25.db00c68a.js"><link rel="prefetch" href="/assets/js/26.75eced52.js"><link rel="prefetch" href="/assets/js/27.141748c3.js"><link rel="prefetch" href="/assets/js/28.4a2b2f52.js"><link rel="prefetch" href="/assets/js/29.f700ec1a.js"><link rel="prefetch" href="/assets/js/3.51e60054.js"><link rel="prefetch" href="/assets/js/30.303c9639.js"><link rel="prefetch" href="/assets/js/31.61e0e098.js"><link rel="prefetch" href="/assets/js/32.2e93f8ac.js"><link rel="prefetch" href="/assets/js/33.7197ed8c.js"><link rel="prefetch" href="/assets/js/34.70cab748.js"><link rel="prefetch" href="/assets/js/35.a2938760.js"><link rel="prefetch" href="/assets/js/36.344d5f62.js"><link rel="prefetch" href="/assets/js/37.ccd6ef99.js"><link rel="prefetch" href="/assets/js/38.f747c3ac.js"><link rel="prefetch" href="/assets/js/39.0014b129.js"><link rel="prefetch" href="/assets/js/40.4bcb8f39.js"><link rel="prefetch" href="/assets/js/41.54d85b43.js"><link rel="prefetch" href="/assets/js/42.8116cd4c.js"><link rel="prefetch" href="/assets/js/43.6f3e70fc.js"><link rel="prefetch" href="/assets/js/44.d6d8abff.js"><link rel="prefetch" href="/assets/js/45.cd9babd6.js"><link rel="prefetch" href="/assets/js/46.cb867dfa.js"><link rel="prefetch" href="/assets/js/47.070d730e.js"><link rel="prefetch" href="/assets/js/48.0cdf0dc3.js"><link rel="prefetch" href="/assets/js/49.3c348071.js"><link rel="prefetch" href="/assets/js/5.d96a2b8c.js"><link rel="prefetch" href="/assets/js/50.70221375.js"><link rel="prefetch" href="/assets/js/51.4d3bfe99.js"><link rel="prefetch" href="/assets/js/52.290b62dd.js"><link rel="prefetch" href="/assets/js/53.bdead276.js"><link rel="prefetch" href="/assets/js/54.af6c538d.js"><link rel="prefetch" href="/assets/js/55.7aa7f892.js"><link rel="prefetch" href="/assets/js/56.fd25720a.js"><link rel="prefetch" href="/assets/js/57.dd9ffee0.js"><link rel="prefetch" href="/assets/js/58.a9fa94d5.js"><link rel="prefetch" href="/assets/js/59.b24205ab.js"><link rel="prefetch" href="/assets/js/6.fff243bb.js"><link rel="prefetch" href="/assets/js/60.c48f9f3c.js"><link rel="prefetch" href="/assets/js/62.d5032578.js"><link rel="prefetch" href="/assets/js/63.0566b7b0.js"><link rel="prefetch" href="/assets/js/64.39f75b2c.js"><link rel="prefetch" href="/assets/js/65.cafbd489.js"><link rel="prefetch" href="/assets/js/66.d2dbf74b.js"><link rel="prefetch" href="/assets/js/67.08618c54.js"><link rel="prefetch" href="/assets/js/68.161678f2.js"><link rel="prefetch" href="/assets/js/69.788810b6.js"><link rel="prefetch" href="/assets/js/7.170b11d7.js"><link rel="prefetch" href="/assets/js/70.fbb3b202.js"><link rel="prefetch" href="/assets/js/71.a3d8b7aa.js"><link rel="prefetch" href="/assets/js/72.46d6c318.js"><link rel="prefetch" href="/assets/js/73.e99efe3a.js"><link rel="prefetch" href="/assets/js/74.fd9eaff7.js"><link rel="prefetch" href="/assets/js/75.6782e97d.js"><link rel="prefetch" href="/assets/js/76.06524762.js"><link rel="prefetch" href="/assets/js/77.aec65f81.js"><link rel="prefetch" href="/assets/js/78.d7ce09bc.js"><link rel="prefetch" href="/assets/js/79.28e1de1e.js"><link rel="prefetch" href="/assets/js/8.13e5b4ae.js"><link rel="prefetch" href="/assets/js/80.917ff461.js"><link rel="prefetch" href="/assets/js/81.745e410a.js"><link rel="prefetch" href="/assets/js/82.9ef78695.js"><link rel="prefetch" href="/assets/js/83.a4ce6c69.js"><link rel="prefetch" href="/assets/js/84.5c274b85.js"><link rel="prefetch" href="/assets/js/85.1991c579.js"><link rel="prefetch" href="/assets/js/86.bdab760b.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.8d41f623.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bb0c19ce.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">Rafael Neto </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/en/blog/" class="nav-link">English</a></li><li class="nav-item"><a href="/blog/" class="nav-link router-link-active">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">Rafael Neto </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/en/blog/" class="nav-link">English</a></li><li class="mobile-nav-item"><a href="/blog/" class="nav-link router-link-active">Blog</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        
      </h1> <div class="post-meta"><!----> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2023-5-10">
      2023-05-10
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/CSharp" data-v-42ccfcd5><span data-v-42ccfcd5>CSharp</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/PatronDeDiseño" data-v-42ccfcd5><span data-v-42ccfcd5>PatronDeDiseño</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h1 id="crear-expresiones-lambda-dinamicamente-mediante-el-patron-builder"><a href="#crear-expresiones-lambda-dinamicamente-mediante-el-patron-builder" class="header-anchor">#</a> Crear expresiones lambda dinámicamente mediante el patrón Builder</h1> <!----> <p>Las expresiones lambda son una herramienta poderosa en el mundo de la programación que nos permite escribir funciones anónimas que pueden ser asignadas a una variable o pasadas como argumentos a una función. En .NET, las expresiones lambda se utilizan comúnmente para definir consultas LINQ en tiempo de compilación y para construir árboles de expresiones que se pueden utilizar para generar consultas SQL dinámicamente.</p> <p>Es el tipo de herramienta perfecta a la hora de construir consultas dinámicamente cuando por ejemplo tenemos un formulario de búsqueda con múltiples campos que opcionalmente pueden o no ser usados para hacer el filtrado de datos. Al combinarlo con el patrón <em>Builder</em> para encapsular la lógica de creación de expresiones lambda junto con la configuración del tipo de comparación, nos permitirá crear expresiones lambda dinámicas muy fácilmente.</p> <h2 id="¿que-son-las-expresiones-lambda"><a href="#¿que-son-las-expresiones-lambda" class="header-anchor">#</a> ¿Qué son las expresiones lambda?</h2> <p>Las expresiones lambda son funciones anónimas que se pueden asignar a una variable o pasar como argumento a una función. En C#, las expresiones lambda se escriben utilizando la sintaxis <code>=&gt;</code>, como se muestra en el siguiente ejemplo:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> numbers <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> evenNumbers <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>En este ejemplo, estamos utilizando una expresión lambda para filtrar los números pares en la matriz <em>numbers</em>. La expresión lambda <code>n =&gt; n % 2 == 0</code> se interpreta como &quot;para cada elemento <em>n</em> en la matriz <em>numbers</em>, devuelve <em>true</em> si <em>n % 2</em> es igual a <em>0</em>&quot;.</p> <p>Las expresiones lambda son especialmente útiles para definir consultas LINQ en tiempo de compilación. En lugar de construir manualmente una consulta SQL, podemos escribir una expresión lambda que represente la consulta y utilizar LINQ para generar la consulta SQL automáticamente.</p> <h2 id="¿que-es-el-patron-builder"><a href="#¿que-es-el-patron-builder" class="header-anchor">#</a> ¿Qué es el patrón Builder?</h2> <p>El patrón <em>Builder</em> es un patrón de diseño creacional que nos permite separar la construcción de un objeto complejo de su representación. En lugar de crear el objeto directamente, utilizamos una clase <em>Builder</em> que encapsula la lógica de construcción del objeto y nos permite configurar sus propiedades de manera flexible.</p> <p>En el contexto de la creación de expresiones lambda, podemos utilizar el patrón <em>Builder</em> para encapsular la lógica de creación de expresiones lambda combinables y para permitir que los consumidores de la clase configuren el tipo de comparador del dato y el tipo de comparador lógico del conjunto de expresiones.</p> <h2 id="creando-una-clase-builder-para-expresiones-lambda"><a href="#creando-una-clase-builder-para-expresiones-lambda" class="header-anchor">#</a> Creando una clase Builder para expresiones lambda</h2> <p>Para crear una clase <em>Builder</em> que encapsule la lógica de crear dinámicamente una expresión lambda basada en una lista de filtros parciales, primero debemos definir una interfaz que represente la funcionalidad que queremos permitir que los usuarios utilicen. En este caso, queremos permitir que los usuarios añadan propiedades de filtrado de un objeto o múltiples subexpresiones y la consiguiente generación de la expresión lambda final con la combinación de todas las propiedades y subexpresiones de filtrado. Así sería La interfaz:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IDynamicLambdaBuilder<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name">DynamicLambdaBuilder<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token function">AddFilter</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> propertyName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name">ComparisonType</span> comparisonType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token return-type class-name">DynamicLambdaBuilder<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token function">And</span><span class="token punctuation">(</span><span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> expression<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token return-type class-name">DynamicLambdaBuilder<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token function">Or</span><span class="token punctuation">(</span><span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> expression<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token return-type class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">Build</span><span class="token punctuation">(</span><span class="token class-name">LogicalOperator</span> logicalOperator<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>La interfaz <em>IDynamicLambdaBuilder&lt;T&gt;</em> utiliza el tipo genérico <em>T</em> para representar el tipo de objeto en el que se está construyendo la expresión lambda. La interfaz define tres métodos:</p> <ul><li><em>AddFilter()</em>: Este método permite que los usuarios añadan filtros que se utilizará en la expresión lambda.</li> <li><em>Add()</em>: Este método permite añadir explícitamente una expresión lambda a nuestros filtros usando el operador &quot;&amp;&amp;&quot;.</li> <li><em>Or()</em>: Este método permite añadir explícitamente una expresión lambda a nuestros filtros usando el operador &quot;||&quot;.</li> <li><em>Build()</em>: Este método construye la expresión lambda definitiva combinando las expresiones y filtros indicados y devuelve un objeto <em>Expression&lt;Func&lt;T, bool&gt;&gt;</em>.</li></ul> <p>Complementaria a dicha interfaz necesitaremos el enumerador que define los tipos de comparadores disponibles para el filtrado de las propiedades:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ComparisonType</span>
<span class="token punctuation">{</span>
    Equals<span class="token punctuation">,</span>
    NotEquals<span class="token punctuation">,</span>
    GreaterThan<span class="token punctuation">,</span>
    GreaterThanOrEquals<span class="token punctuation">,</span>
    LessThan<span class="token punctuation">,</span>
    LessThanOrEquals<span class="token punctuation">,</span>
    Contains
<span class="token punctuation">}</span>
</code></pre></div><p>Y el enumerador que define el tipo de operador a usar a la hora de combinar todas las opciones de filtrado:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">LogicalOperator</span>
<span class="token punctuation">{</span>
    And<span class="token punctuation">,</span>
    Or
<span class="token punctuation">}</span>
</code></pre></div><p>Finalmente, la implementación de la interfaz <em>IDynamicLambdaBuilder</em> podría ser la siguiente:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq<span class="token punctuation">.</span>Expressions</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicLambdaBuilder<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ParameterExpression</span> _parameter<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">List<span class="token punctuation">&lt;</span>Expression<span class="token punctuation">&gt;</span></span> _expressions<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">DynamicLambdaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _parameter <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Parameter</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;e&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _expressions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Expression<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">DynamicLambdaBuilder<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token function">AddFilter</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> propertyName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name">ComparisonType</span> comparisonType <span class="token operator">=</span> ComparisonType<span class="token punctuation">.</span>Equals<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> property <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Property</span><span class="token punctuation">(</span>_parameter<span class="token punctuation">,</span> propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> constant <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Constant</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> binary <span class="token operator">=</span> <span class="token function">GetBinaryExpression</span><span class="token punctuation">(</span>property<span class="token punctuation">,</span> constant<span class="token punctuation">,</span> comparisonType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _expressions<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">DynamicLambdaBuilder<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token function">And</span><span class="token punctuation">(</span><span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> expression<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _expressions<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">DynamicLambdaBuilder<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token function">Or</span><span class="token punctuation">(</span><span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> expression<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _expressions<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>Expression<span class="token punctuation">.</span><span class="token function">Not</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">Build</span><span class="token punctuation">(</span><span class="token class-name">LogicalOperator</span> logicalOperator <span class="token operator">=</span> LogicalOperator<span class="token punctuation">.</span>And<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_expressions<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> e <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name"><span class="token keyword">var</span></span> body <span class="token operator">=</span> _expressions<span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> logicalOperator <span class="token operator">==</span> <span class="token return-type class-name">LogicalOperator<span class="token punctuation">.</span>And <span class="token punctuation">?</span></span> Expression<span class="token punctuation">.</span><span class="token function">AndAlso</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token punctuation">:</span> Expression<span class="token punctuation">.</span><span class="token function">OrElse</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> Expression<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Lambda</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> _parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name">BinaryExpression</span> <span class="token function">GetBinaryExpression</span><span class="token punctuation">(</span><span class="token class-name">MemberExpression</span> property<span class="token punctuation">,</span> <span class="token class-name">ConstantExpression</span> constant<span class="token punctuation">,</span> <span class="token class-name">ComparisonType</span> comparisonType<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>comparisonType<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">case</span> ComparisonType<span class="token punctuation">.</span>Equals<span class="token punctuation">:</span>
                <span class="token keyword">return</span> Expression<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>property<span class="token punctuation">,</span> constant<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> ComparisonType<span class="token punctuation">.</span>NotEquals<span class="token punctuation">:</span>
                <span class="token keyword">return</span> Expression<span class="token punctuation">.</span><span class="token function">NotEqual</span><span class="token punctuation">(</span>property<span class="token punctuation">,</span> constant<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> ComparisonType<span class="token punctuation">.</span>GreaterThan<span class="token punctuation">:</span>
                <span class="token keyword">return</span> Expression<span class="token punctuation">.</span><span class="token function">GreaterThan</span><span class="token punctuation">(</span>property<span class="token punctuation">,</span> constant<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> ComparisonType<span class="token punctuation">.</span>GreaterThanOrEquals<span class="token punctuation">:</span>
                <span class="token keyword">return</span> Expression<span class="token punctuation">.</span><span class="token function">GreaterThanOrEqual</span><span class="token punctuation">(</span>property<span class="token punctuation">,</span> constant<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> ComparisonType<span class="token punctuation">.</span>LessThan<span class="token punctuation">:</span>
                <span class="token keyword">return</span> Expression<span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span>property<span class="token punctuation">,</span> constant<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> ComparisonType<span class="token punctuation">.</span>LessThanOrEquals<span class="token punctuation">:</span>
                <span class="token keyword">return</span> Expression<span class="token punctuation">.</span><span class="token function">LessThanOrEqual</span><span class="token punctuation">(</span>property<span class="token punctuation">,</span> constant<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> ComparisonType<span class="token punctuation">.</span>Contains<span class="token punctuation">:</span>
                <span class="token class-name"><span class="token keyword">var</span></span> method <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">string</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetMethod</span><span class="token punctuation">(</span><span class="token string">&quot;Contains&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">string</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> methodCallExpression <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>property<span class="token punctuation">,</span> method<span class="token punctuation">,</span> constant<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> Expression<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>methodCallExpression<span class="token punctuation">,</span> Expression<span class="token punctuation">.</span><span class="token function">Constant</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token punctuation">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Invalid comparison type: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">comparisonType</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>En este ejemplo, la clase <em>DynamicLambdaBuilder&lt;T&gt;</em> es una clase genérica que toma un parámetro de tipo <em>T</em> que representa el tipo de las entidades de la colección que desea filtrar. La clase tiene un constructor que inicializa una expresión de parámetro para el parámetro lambda y una lista de objetos de expresión para almacenar las expresiones de filtro.</p> <p>El método <em>AddFilter</em> toma un nombre de propiedad, un valor y un argumento <em>ComparisonType</em> opcional que especifica el tipo de comparación que se usará (el valor predeterminado es <em>Equals</em>). El método crea una <em>MemberExpression</em> para la propiedad, una <em>ConstantExpression</em> para el valor y una <em>BinaryExpression</em> para la comparación, según el tipo de comparación.</p> <p>El método <em>Build</em> toma un argumento <em>LogicalOperator</em> opcional que especifica el operador lógico que se usará al combinar las expresiones de filtro (el valor predeterminado es <em>And</em>_). El método agrega las expresiones de filtro mediante el operador lógico especificado y crea una expresión lambda que toma un solo parámetro de tipo <em>T</em> y devuelve un bool.</p> <p>Podemos usar la clase <em>DynamicLambdaBuilder&lt;T&gt;</em> para crear expresiones lambda dinámicas basadas en un número variable de nombres y valores de propiedad como sigue:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> expresionBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DynamicLambdaBuilder<span class="token punctuation">&lt;</span>MyEntity<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// request is an object that represents a fictitious request</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>Property1 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    expresionBuilder<span class="token punctuation">.</span><span class="token function">AddFilter</span><span class="token punctuation">(</span><span class="token string">&quot;PropertyName1&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>Property1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>Property2 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    expresionBuilder<span class="token punctuation">.</span><span class="token function">AddFilter</span><span class="token punctuation">(</span><span class="token string">&quot;PropertyName2&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>Property2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>Property3 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    expresionBuilder<span class="token punctuation">.</span><span class="token function">And</span><span class="token punctuation">(</span>m <span class="token operator">=&gt;</span> m<span class="token punctuation">.</span>PropertyName3 <span class="token operator">==</span> request<span class="token punctuation">.</span>Property3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>Property4 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    expresionBuilder<span class="token punctuation">.</span><span class="token function">Or</span><span class="token punctuation">(</span>m <span class="token operator">=&gt;</span> m<span class="token punctuation">.</span>PropertyName4 <span class="token operator">==</span> request<span class="token punctuation">.</span>Property4<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// _context is a an object that represents my db context</span>
<span class="token class-name"><span class="token keyword">var</span></span> searchResult <span class="token operator">=</span> _context<span class="token punctuation">.</span>MyEntities
    <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>expresionBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <!----></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#¿que-son-las-expresiones-lambda" title="¿Qué son las expresiones lambda?">¿Qué son las expresiones lambda?</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#¿que-es-el-patron-builder" title="¿Qué es el patrón Builder?">¿Qué es el patrón Builder?</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#creando-una-clase-builder-para-expresiones-lambda" title="Creando una clase Builder para expresiones lambda">Creando una clase Builder para expresiones lambda</a></div></div></div></div> <footer class="footer" data-v-fdbf4940><div class="footer-left-wrap" data-v-fdbf4940><ul class="contact" data-v-fdbf4940><li class="contact-item" data-v-fdbf4940><a href="https://x.com/RNeto" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-fdbf4940><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter" data-v-fdbf4940><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" data-v-fdbf4940></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-fdbf4940><ul class="copyright" data-v-fdbf4940><li class="copyright-item" data-v-fdbf4940><a href="/index.html" class="nav-link" data-v-fdbf4940>Rafael Neto © 2025</a></li></ul></div></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.ee019d85.js" defer></script><script src="/assets/js/4.35e6b205.js" defer></script><script src="/assets/js/1.801c1b6e.js" defer></script><script src="/assets/js/61.6ae343dc.js" defer></script>
  </body>
</html>
